<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шифратор/Дешифратор</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .text-container {
            width: 80%;
            margin-bottom: 20px;
            position: relative;
        }

        .text-area {
            background-color: black;
            color: green;
            border: 1px solid green;
            width: 100%;
            height: 200px;
            font-size: 16px;
            padding: 10px;
            resize: none;
        }

        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background-color: black;
            color: green;
            border: 1px solid green;
            padding: 5px 10px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: #111;
        }

        h1 {
            color: green;
            margin-bottom: 30px;
        }

        .mode-indicator {
            margin-bottom: 20px;
            font-size: 18px;
            color: #0f0;
        }
    </style>
</head>
<body>
    <h1>Шифратор/Дешифратор</h1>

    <div class="mode-indicator" id="modeIndicator">Режим: Определяется автоматически</div>

    <div class="text-container">
        <textarea id="inputText" class="text-area" placeholder="Введите текст здесь..."></textarea>
        <button class="copy-btn" onclick="copyToClipboard('inputText')">Копировать</button>
    </div>

    <div class="text-container">
        <textarea id="outputText" class="text-area" placeholder="Результат появится здесь..." readonly></textarea>
        <button class="copy-btn" onclick="copyToClipboard('outputText')">Копировать</button>
    </div>

    <script>
        // Полный словарь для шифрования
        const encryptMap = {
            "а":"q", "б":"R", "в":"\\/", "г":"*g", "д":"k", "е":"zz", "ё":"'", "ж":"}{", "з":"Q",
            "и":"f", "й":"F", "к":"~a", "л":"?n", "м":"@", "н":"#", "о":"$$", "п":"_+_", "р":"s",
            "с":"&", "т":"|-", "у":"Y", "ф":"d", "х":"+", "ц":">>", "ч":"<<", "ш":"X", "щ":"/X",
            "ь":"n", "ы":"/n", "ъ":"//n", "э":":O", "ю":";;", "я":"m"
        };

        // Создаем обратный словарь для дешифровки
        const decryptMap = {};
        for (const [key, value] of Object.entries(encryptMap)) {
            decryptMap[value] = key;
        }

        // Сортированные последовательности для дешифровки (от самых длинных к коротким)
        const decryptSequences = Object.keys(decryptMap).sort((a, b) => b.length - a.length);

        // Элементы DOM
        const modeIndicator = document.getElementById('modeIndicator');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');

        // Обновление вывода при вводе
        inputText.addEventListener('input', updateOutput);

        function updateOutput() {
            const inputContent = inputText.value;
            let result = [];
            
            if (inputContent.startsWith('%')) {
                modeIndicator.textContent = "Режим: Дешифровка";
                const contentToDecrypt = inputContent.substring(1);
                result = decryptText(contentToDecrypt);
            } else if (inputContent.trim() !== '') {
                modeIndicator.textContent = "Режим: Шифровка";
                const encrypted = encryptText(inputContent);
                result = ['%', ...encrypted];
            } else {
                modeIndicator.textContent = "Режим: Ожидание ввода";
                result = [];
            }

            outputText.value = result.join("");
        }

        function encryptText(text) {
            let encrypted = [];
            for (let char of text.toLowerCase()) {
                encrypted.push(encryptMap[char] || char);
            }
            return encrypted;
        }

        function decryptText(text) {
            let decrypted = [];
            let i = 0;
            
            while (i < text.length) {
                let found = false;
                
                // Проверяем все возможные последовательности
                for (const seq of decryptSequences) {
                    if (text.startsWith(seq, i)) {
                        decrypted.push(decryptMap[seq]);
                        i += seq.length;
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    // Если последовательность не найдена, добавляем символ как есть
                    decrypted.push(text[i]);
                    i++;
                }
            }
            
            return decrypted;
        }

        // Функция копирования в буфер обмена
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // Показываем уведомление
            const originalText = event.target.textContent;
            event.target.textContent = 'Скопировано!';
            setTimeout(() => {
                event.target.textContent = originalText;
            }, 2000);
        }

        // Обработка сочетаний клавиш
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch (event.keyCode) {
                    case 65: // Ctrl+A (Select All)
                        event.preventDefault();
                        if (document.activeElement === inputText || document.activeElement === outputText) {
                            document.activeElement.select();
                        }
                        break;
                    case 67: // Ctrl+C (Copy)
                        if (document.activeElement === outputText && outputText.selectionStart !== outputText.selectionEnd) {
                            return;
                        }
                        break;
                    case 86: // Ctrl+V (Paste)
                        if (document.activeElement === inputText) {
                            return;
                        }
                        break;
                    case 88: // Ctrl+X (Cut)
                        if (document.activeElement === inputText && inputText.selectionStart !== inputText.selectionEnd) {
                            return;
                        }
                        break;
                }
            }
        });

        // Тестовый пример
        inputText.value = '%&//nzzXn zz/X\' :O|-f+ @m*g~af+ dsq#>>YQ&~af+ RY?n$$~a, kq \\//n_+_zzF }{zz <<q;;';
        updateOutput();
    </script>
</body>
</html>
