<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шифратор/Дешифратор</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .text-container {
            width: 80%;
            margin-bottom: 20px;
            position: relative;
        }

        .text-area {
            background-color: black;
            color: green;
            border: 1px solid green;
            width: 100%;
            height: 200px;
            font-size: 16px;
            padding: 10px;
            resize: none;
        }

        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background-color: black;
            color: green;
            border: 1px solid green;
            padding: 5px 10px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: #111;
        }

        h1 {
            color: green;
            margin-bottom: 30px;
        }

        .mode-indicator {
            margin-bottom: 20px;
            font-size: 18px;
            color: #0f0;
        }
    </style>
</head>
<body>
    <h1>Шифратор/Дешифратор</h1>

    <div class="mode-indicator" id="modeIndicator">Режим: Определяется автоматически</div>

    <div class="text-container">
        <textarea id="inputText" class="text-area" placeholder="Введите текст здесь..."></textarea>
        <button class="copy-btn" onclick="copyToClipboard('inputText')">Копировать</button>
    </div>

    <div class="text-container">
        <textarea id="outputText" class="text-area" placeholder="Результат появится здесь..." readonly></textarea>
        <button class="copy-btn" onclick="copyToClipboard('outputText')">Копировать</button>
    </div>

    <script>
        // Словарь для шифрования
        const switchMap = {"а":"q", "б":"R", "в":"\/", "г":"*g", "д":"k", "е":"zz", "ё":"'", "ж":"}{", "з":"Q",
            "и":"f", "й":"F", "к":"~a", "л":"?n", "м":"@", "н":"#", "о":"$$", "п":"_+_", "р":"s",
              "с":"&", "т":"|-", "у":"Y", "ф":"d", "х":"+", "ц":">>", "ч":"<<", "ш":"X", "щ":"/X",
               "ь":"n", "ы":"/n", "ъ":"//n", "э":":O", "ю":";;", "я":"m"};

        // Элементы DOM
        const modeIndicator = document.getElementById('modeIndicator');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');

        // Обновление вывода при вводе
        inputText.addEventListener('input', updateOutput);

        function updateOutput() {
            const inputContent = inputText.value;
            let translated = [];
            let mode;

            // Определяем режим по наличию % в начале текста
            if (inputContent.startsWith('%')) {
                mode = "decrypt";
                modeIndicator.textContent = "Режим: Дешифровка";
                // Удаляем символ % для дешифровки
                const contentToDecrypt = inputContent.substring(1);
                
                // Режим дешифровки
                let i = 0;
                while (i < contentToDecrypt.length) {
                    let found = false;

                    // Сначала проверяем самые длинные последовательности
                    if (contentToDecrypt.startsWith("//n", i)) {
                        translated.push("ъ");
                        i += 3;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("<<", i)) {
                        translated.push("ч");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith(">>", i)) {
                        translated.push("ц");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("_+_", i)) {
                        translated.push("п");
                        i += 3;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("$$", i)) {
                        translated.push("о");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("\\/", i)) {
                        translated.push("в");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("/X", i)) {
                        translated.push("щ");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("/n", i)) {
                        translated.push("ы");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("zz", i)) {
                        translated.push("е");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith(";;", i)) {
                        translated.push("ю");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith(":O", i)) {
                        translated.push("э");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("~a", i)) {
                        translated.push("к");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("?n", i)) {
                        translated.push("л");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("*g", i)) {
                        translated.push("г");
                        i += 2;
                        found = true;
                    }
                    else if (contentToDecrypt.startsWith("|-", i)){
                        translated.push("т");
                        i += 2;
                        found = true;
                    }
                    // Затем проверяем одиночные символы
                    else {
                        for (const [plain, cipher] of Object.entries(switchMap)) {
                            if (cipher.length === 1 && contentToDecrypt[i] === cipher) {
                                translated.push(plain);
                                i += 1;
                                found = true;
                                break;
                            }
                        }
                    }

                    if (!found) {
                        translated.push(contentToDecrypt[i]);
                        i += 1;
                    }
                }
            } else {
                mode = "encrypt";
                modeIndicator.textContent = "Режим: Шифровка";
                
                // Режим шифрования
                for (let char of inputContent.toLowerCase()) {
                    translated.push(switchMap[char] || char);
                }
                // Добавляем символ % к зашифрованному тексту
                if (translated.length > 0) {
                    translated.unshift('%');
                }
            }

            outputText.value = translated.join("");
        }

        // Функция копирования в буфер обмена
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // Показываем уведомление
            const originalText = event.target.textContent;
            event.target.textContent = 'Скопировано!';
            setTimeout(() => {
                event.target.textContent = originalText;
            }, 2000);
        }

        // Обработка сочетаний клавиш
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch (event.keyCode) {
                    case 65: // Ctrl+A (Select All)
                        event.preventDefault();
                        if (document.activeElement === inputText || document.activeElement === outputText) {
                            document.activeElement.select();
                        }
                        break;
                    case 67: // Ctrl+C (Copy)
                        if (document.activeElement === outputText && outputText.selectionStart !== outputText.selectionEnd) {
                            // Разрешаем копирование из outputText
                            return;
                        }
                        break;
                    case 86: // Ctrl+V (Paste)
                        if (document.activeElement === inputText) {
                            // Разрешаем вставку в inputText
                            return;
                        }
                        break;
                    case 88: // Ctrl+X (Cut)
                        if (document.activeElement === inputText && inputText.selectionStart !== inputText.selectionEnd) {
                            // Разрешаем вырезание из inputText
                            return;
                        }
                        break;
                }
            }
        });
    </script>
</body>
</html>
